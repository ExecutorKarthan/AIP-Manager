function formatAndUpdateSheets(weekSheet, sourceSheet, listOfEditors) {
  class Student{
    constructor(name, grade, aipTeacher){
      this.name = name;
      this.grade = grade;
      this.aipTeacher = aipTeacher;
    }
    defFirstTeacher(firstTeacher){
      this.firstTeacher = firstTeacher;
    }
    defSecondTeacher(secondTeacher){
      this.secondTeacher = secondTeacher;
    }
    defThirdTeacher(thirdTeacher){
      this.thirdTeacher = thirdTeacher;
    }
    defOtherTeacher(otherTeacher){
      this.otherTeacher = otherTeacher;
    }
  }

//Create a function to handle the formatting
  function formatSheet(sheetTab){
      //Add Headers
      sheetTab.getRange(1, 1).setValue("Student Name");
      sheetTab.getRange(1, 2).setValue("Student Grade");
      sheetTab.getRange(1, 3).setValue("AIP teacher");
      sheetTab.getRange(1, 4).setValue("Priority A Teacher");
      sheetTab.getRange(1, 5).setValue("Priority B Teacher");
      sheetTab.getRange(1, 6).setValue("Priority C Teacher");
      sheetTab.getRange(1, 7).setValue("Additional Teacher");
      sheetTab.getRange(1, 8).setValue("Absent?");
      sheetTab.getRange(1, 9).setValue("Sent?");
      sheetTab.getRange(1, 10).setValue("Notes");
      if(sheetTab.getName() == "Mon"){
        sheetTab.getRange(2, 4, 1, 1).setValue("=Directions!B2");  
        sheetTab.getRange(2, 5, 1, 1).setValue("=Directions!B2");  
        sheetTab.getRange(2, 6, 1, 1).setValue("=Directions!B2");  
        sheetTab.getRange(2, 7, 1, 1).setValue("Other Requests");  
      }
      if(sheetTab.getName() == "Tues"){
        sheetTab.getRange(2, 4, 1, 1).setValue("=Directions!C2");  
        sheetTab.getRange(2, 5, 1, 1).setValue("=Directions!C2");  
        sheetTab.getRange(2, 6, 1, 1).setValue("=Directions!C2");  
        sheetTab.getRange(2, 7, 1, 1).setValue("Other Requests");
      }
      if(sheetTab.getName() == "Wed"){
        sheetTab.getRange(2, 4, 1, 1).setValue("=Directions!D2");  
        sheetTab.getRange(2, 5, 1, 1).setValue("=Directions!D2");  
        sheetTab.getRange(2, 6, 1, 1).setValue("=Directions!D2");  
        sheetTab.getRange(2, 7, 1, 1).setValue("Other Requests");
      }
      if(sheetTab.getName() == "Thurs"){
        sheetTab.getRange(2, 4, 1, 1).setValue("=Directions!E2");  
        sheetTab.getRange(2, 5, 1, 1).setValue("=Directions!E2");  
        sheetTab.getRange(2, 6, 1, 1).setValue("=Directions!E2");  
        sheetTab.getRange(2, 7, 1, 1).setValue("Other Requests");
      }
      if(sheetTab.getName() == "Fri"){
        sheetTab.getRange(2, 4, 1, 1).setValue("=Directions!F2");  
        sheetTab.getRange(2, 5, 1, 1).setValue("=Directions!F2");  
        sheetTab.getRange(2, 6, 1, 1).setValue("=Directions!F2");  
        sheetTab.getRange(2, 7, 1, 1).setValue("Other Requests");
      }

      //Add # of requests calculation
      sheetTab.getRange(2, 10).setValue("=CONCAT(\"# of Requests Today: \", (COUNTA(D5:G10000)))");
    
      // Define last rows and columns for ease of use
      var tabLastRow = sheetTab.getLastRow()
      var tabLastColumn = sheetTab.getLastColumn()

      //Add check boxes
      sheetTab.getRange(4, 8, tabLastRow-3, 2).insertCheckboxes()

      //Add conditional formatting
      nameRange = sheetTab.getRange(4, 1, tabLastRow, 1)
      absentRule = SpreadsheetApp.newConditionalFormatRule().whenFormulaSatisfied("= H4 = TRUE").setBackground('Magenta').setRanges([nameRange]).build()
      sentRule = SpreadsheetApp.newConditionalFormatRule().whenFormulaSatisfied("= I4 = TRUE").setBackground('#b7e1cd').setRanges([nameRange]).build()
      rules = sheetTab.getConditionalFormatRules()
      rules.push(absentRule)
      rules.push(sentRule)
      sheetTab.setConditionalFormatRules(rules)
      console.log("Conditional formatting completed.")

      //Format the sheet's color scheme
      sheetTab.getRange(1,1,1,tabLastColumn).setBackground('#4dd0e1')
      sheetTab.getRange(2,1,tabLastRow+50,tabLastColumn).setBackground("white")
      for (var x = 3; x < tabLastRow + 50; x = x + 2){
        sheetTab.getRange(x,1, 1, tabLastColumn).setBackground('#e0f7fa')
      }

      //Freeze cells for ease of viewing
      sheetTab.setFrozenColumns(3);
      sheetTab.setFrozenRows(3);

      //Protect the sheet while keeping some cells editible
      var protection = sheetTab.protect()
      var me = Session.getEffectiveUser();
      protection.addEditor(me);
      protection.removeEditors(protection.getEditors());
      if (protection.canDomainEdit()) {
        protection.setDomainEdit(false);
      }
      var editableCells = sheetTab.getRange("D4:J1000");
      protection.setUnprotectedRanges([editableCells]);
      for(var editor = 0; editor < listOfEditors.length; editor++){
        protection.addEditor(listOfEditors[editor]);
      }

      //Correct for justification
      sheetTab.getRange(1, 1, 2, 10).setHorizontalAlignment("Center");
      sheetTab.getRange(4, 2, 1000, 1).setHorizontalAlignment("Left");

      //Adjust text to wrap
      sheetTab.getRange(1, 1, 1000, 10).setWrap(true);

      //Adjust Font size
      sheetTab.getRange(1, 1, 1000, 10).setFontSize(9);

      //Resize the all columns to fit their text
      sheetTab.autoResizeColumns(1,7);
      sheetTab.autoResizeColumn(10);

      //Adjust column width to fit correctly
      for( var column = 1; column < 7; column++){
        var cellWidth = sheetTab.getColumnWidth(column);
        if(column == 3){
          cellWidth =  cellWidth - 10*(cellWidth/100);
        }
        else{
          cellWidth =  cellWidth - 35*(cellWidth/100);
        }
        sheetTab.setColumnWidth(column, cellWidth);
      }

      console.log("Text formatting completed.")

      //Add data validation to cells
      /*
      var validationRange = sheetTab.getRange(4, 4, tabLastRow, 4);
      var teacherIndexLastRow = SpreadsheetApp.openByUrl("https://docs.google.com/spreadsheets/d/1OE_bEE2AGaTTnkACDo52vZmw8uwcZDSffpMjMq8_Xv8/edit#gid=0").sourceSheet.getSheetByName("Teacher Index").getLastRow();
      var posValuesRange = SpreadsheetApp.openByUrl("https://docs.google.com/spreadsheets/d/1OE_bEE2AGaTTnkACDo52vZmw8uwcZDSffpMjMq8_Xv8/edit#gid=0").sourceSheet.getSheetByName("Teacher Index").getRange(2, 5, teacherIndexLastRow, 1);
      var validationRule = SpreadsheetApp.newDataValidation().requireValueInRange(posValuesRange).build();
      validationRange.setDataValidation(validationRule);
      */
      console.log("Formatting completed")
  }

  //create an array to store the objects
  var objArray = []

  // Define last rows and columns for ease of use
  var lastRow = sourceSheet.getLastRow()
  var lastColumn = sourceSheet.getLastColumn()

  //Find and remove duplicates using a double loop
  var knownNames = sourceSheet.getRange(1, 6, lastRow, 1).getValues();
  var nameCount = 0;
  knownNames.forEach((outerVal, outerIndex)=>{
    knownNames.forEach((innerVal, innerIndex)=>{
        if(outerVal[0] == innerVal[0] && nameCount == 1){
          var emptyList = [["", "", "", "", ""]]
          sourceSheet.getRange(innerIndex+1, 1, 1, 5).setValues(emptyList);
        }
        if(outerVal[0] == innerVal[0] && nameCount == 0){
          nameCount = 1; 
        }
      }
    )
    nameCount = 0;
    knownNames = sourceSheet.getRange(1, 5, lastRow, 5).getValues();
    }
  )
  console.log("Duplicate entries have been removed.")

  //Sort the source sheet for accuracy and formating
  sourceSheet.getRange(1,1,lastRow, lastColumn).sort([{column: 5, ascending: true},{column: 1, ascending:true}])
  var blankTest = sourceSheet.getRange(1,1, 3, 1).getValues()
  while (blankTest != ''){
    sourceSheet.insertRowBefore(1)
    blankTest = sourceSheet.getRange(1,1,3, 1).getValues()[2]
  }

  //Define the ranges that need to be copied into variables
  gradeSource = sourceSheet.getRange(4,3, lastRow, 1);
  aipTeacherSource = sourceSheet.getRange(4,5, lastRow, 1);
  studentNameSource = sourceSheet.getRange(4,6, lastRow, 1);

  //Determine how many sheets there are
  numOfSheets = weekSheet.length

  //Build objects and fill them with their data
  for(var x = 0; x < (lastRow - 3); x++){
    var nickName = sourceSheet.getRange(x+4, 4, 1, 1).getValues()[0][0];
    var lastName = sourceSheet.getRange(x+4, 1, 1, 1).getValues()[0][0];
    var firstName = sourceSheet.getRange(x+4, 2, 1, 1).getValues()[0][0];
    if(nickName == ""){
      var processedName = lastName + ", " + firstName;  
    }
    else{
      var processedName = lastName + ", " + nickName;
    }
    objArray.push(new Student(processedName, gradeSource.getValues()[x][0], aipTeacherSource.getValues()[x][0]))
    //console.log("Here is the student object with its data: " + objArray[x].name + "\n" + objArray[x].grade + "\n" + objArray[x].aipTeacher)
  }
  console.log("Student objects have been created and populated.")

for(var tab = 1; tab < numOfSheets; tab ++){
    //Assumes the new sheet is completely blank - for formatting a brand new sheet
    if(weekSheet[tab].getRange(1,1,10,10).isBlank()){
      console.log("Blank Sheet Detected");
      //Copy over all student data
      for(var objNum = 0; objNum < objArray.length; objNum++){
        var changeArray = [[objArray[objNum].name, objArray[objNum].grade, objArray[objNum].aipTeacher]];
        var rowToFill = weekSheet[tab].getRange(4+objNum, 1, 1, 3);
        rowToFill.setValues(changeArray);
      }
      formatSheet(weekSheet[tab]);
    }
    //Assumes sheet has preexisting data in it to process
    else{
      //console.log("Filled Sheet Detected");
      // Define last rows and columns for ease of use
      tabLastRow = weekSheet[tab].getLastRow()
      tabLastColumn = weekSheet[tab].getLastColumn()
    
      //Get all the data from the target sheet
      var targetRangeData = weekSheet[tab].getRange(1, 1, tabLastRow, 7).getValues();
      
      //Create a map of the target data
      var targetRangeFirstColumn = weekSheet[tab].getRange(4, 1, tabLastRow, 1).getValues();
      var targetRangeNameToRow = {}; 
      targetRangeFirstColumn.forEach((value, index ) => {
        targetRangeNameToRow[value[0]] = index + 4; 
        }
      )

      //check each student name on the target sheet against the student objects in the array. Update the object if they match
      for(var arrayValue = 0; arrayValue < objArray.length; arrayValue++){
        if(targetRangeNameToRow[objArray[arrayValue].name] == null){
          continue;
        }
        var correspondingRow = targetRangeNameToRow[objArray[arrayValue].name]-1;
        objArray[arrayValue].firstTeacher = targetRangeData[correspondingRow][3];
        objArray[arrayValue].secondTeacher = targetRangeData[correspondingRow][4];
        objArray[arrayValue].thirdTeacher = targetRangeData[correspondingRow][5];
        objArray[arrayValue].otherTeacher = targetRangeData[correspondingRow][6];    
        }
      
      //Clear out old data
      weekSheet[tab].getRange(1, 1, 1000, 10).clear();
      weekSheet[tab].getRange(1, 8, 1000, 2).removeCheckboxes()
      console.log("Old Data has been deleted")
    
      //Copy over all student data
      for(var objNum = 0; objNum < objArray.length; objNum++){
        var changeArray = [[objArray[objNum].name, objArray[objNum].grade, objArray[objNum].aipTeacher, objArray[objNum].firstTeacher, objArray[objNum].secondTeacher, objArray[objNum].thirdTeacher, objArray[objNum].otherTeacher]];
        var rowToFill = weekSheet[tab].getRange(4+objNum, 1, 1, 7);
        rowToFill.setValues(changeArray);
      }
      console.log("Student Data has been copied over")
      formatSheet(weekSheet[tab]);
    }
  }
}
